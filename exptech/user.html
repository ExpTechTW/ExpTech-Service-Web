<html lang="zh-Hant">

<head>
    <title id="title">TREM Service Panel</title>
    <meta charset="utf-8" />
    <meta content="ExpTech Studio" property="og:title" />
    <meta content="ExpTech | 探索科技 | 用戶資訊面板" property="og:description" />
    <meta content="https://exptech.com.tw/api/v1/file/exptech/index.html" property="og:url" />
    <meta content="https://raw.githubusercontent.com/ExpTechTW/ExpTechTW.github.io/master/image/main/ExpTech.jpg"
        property="og:image" />
</head>

<body>
    <div class="title">ExpTech Studio</div>
    <div class="subtitle">TREM Service Panel</div>
    <div class="main">
        <div class="menu">
            <div id="menu-index" class="menu-item" style="color: white;">首頁</div>
            <div id="menu-service" class="menu-item">服務</div>
            <div id="menu-key" class="menu-item">金鑰</div>
            <div id="menu-status" class="menu-item">狀態</div>
            <div id="menu-device" class="menu-item">設備</div>
            <div id="menu-info" class="menu-item">關於</div>
        </div>
        <div class="box">
            <div id="box-index" class="box-item" style="display: block;">
                <div style="display: flex;align-items: center;">
                    <div style="font-size: 30px;font-weight: 900;padding: 10px;">帳戶訊息</div>
                    <div class="load" onclick="load()">刷新</div>
                </div>
                <div id="info-page">
                    <div style="display: flex;">
                        <div class="box-items" style="background-color: darkblue;">
                            <div style="font-size: 24px;font-weight: 900;">剩餘硬幣數量</div>
                            <div style="display: flex;align-items: center;">
                                <svg xmlns="http://www.w3.org/2000/svg" style="color: yellow;" width="45px"
                                    height="45px" fill="currentColor" class="bi bi-coin" viewBox="0 0 16 16">
                                    <path
                                        d="M5.5 9.511c.076.954.83 1.697 2.182 1.785V12h.6v-.709c1.4-.098 2.218-.846 2.218-1.932 0-.987-.626-1.496-1.745-1.76l-.473-.112V5.57c.6.068.982.396 1.074.85h1.052c-.076-.919-.864-1.638-2.126-1.716V4h-.6v.719c-1.195.117-2.01.836-2.01 1.853 0 .9.606 1.472 1.613 1.707l.397.098v2.034c-.615-.093-1.022-.43-1.114-.9H5.5zm2.177-2.166c-.59-.137-.91-.416-.91-.836 0-.47.345-.822.915-.925v1.76h-.005zm.692 1.193c.717.166 1.048.435 1.048.91 0 .542-.412.914-1.135.982V8.518l.087.02z" />
                                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                                    <path
                                        d="M8 13.5a5.5 5.5 0 1 1 0-11 5.5 5.5 0 0 1 0 11zm0 .5A6 6 0 1 0 8 2a6 6 0 0 0 0 12z" />
                                </svg>
                                <div id="coin" style="font-size: 45px;padding: 10px;"></div>
                            </div>
                        </div>
                        <div class="box-items" style="background-color: darkred;">
                            <div style="font-size: 24px;font-weight: 900;">每日消耗數量</div>
                            <div style="display: flex;align-items: center;">
                                <svg xmlns="http://www.w3.org/2000/svg" style="color: yellow;" width="45px"
                                    height="45px" fill="currentColor" class="bi bi-coin" viewBox="0 0 16 16">
                                    <path
                                        d="M5.5 9.511c.076.954.83 1.697 2.182 1.785V12h.6v-.709c1.4-.098 2.218-.846 2.218-1.932 0-.987-.626-1.496-1.745-1.76l-.473-.112V5.57c.6.068.982.396 1.074.85h1.052c-.076-.919-.864-1.638-2.126-1.716V4h-.6v.719c-1.195.117-2.01.836-2.01 1.853 0 .9.606 1.472 1.613 1.707l.397.098v2.034c-.615-.093-1.022-.43-1.114-.9H5.5zm2.177-2.166c-.59-.137-.91-.416-.91-.836 0-.47.345-.822.915-.925v1.76h-.005zm.692 1.193c.717.166 1.048.435 1.048.91 0 .542-.412.914-1.135.982V8.518l.087.02z" />
                                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                                    <path
                                        d="M8 13.5a5.5 5.5 0 1 1 0-11 5.5 5.5 0 0 1 0 11zm0 .5A6 6 0 1 0 8 2a6 6 0 0 0 0 12z" />
                                </svg>
                                <div id="use" style="font-size: 45px;padding: 10px;"></div>
                            </div>
                        </div>
                    </div>
                    <div style="display: flex;">
                        <div class="box-items" style="background-color: darkgreen;">
                            <div style="font-size: 24px;font-weight: 900;">預計剩餘天數</div>
                            <div id="day" style="font-size: 45px;padding: 10px;"></div>
                        </div>
                        <div class="box-items" style="background-color: darkgoldenrod;">
                            <div style="font-size: 24px;font-weight: 900;">客戶端連接數</div>
                            <div style="display: flex;align-items: center;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="45px" height="45px" fill="currentColor"
                                    class="bi bi-speedometer" viewBox="0 0 16 16">
                                    <path
                                        d="M8 2a.5.5 0 0 1 .5.5V4a.5.5 0 0 1-1 0V2.5A.5.5 0 0 1 8 2zM3.732 3.732a.5.5 0 0 1 .707 0l.915.914a.5.5 0 1 1-.708.708l-.914-.915a.5.5 0 0 1 0-.707zM2 8a.5.5 0 0 1 .5-.5h1.586a.5.5 0 0 1 0 1H2.5A.5.5 0 0 1 2 8zm9.5 0a.5.5 0 0 1 .5-.5h1.5a.5.5 0 0 1 0 1H12a.5.5 0 0 1-.5-.5zm.754-4.246a.389.389 0 0 0-.527-.02L7.547 7.31A.91.91 0 1 0 8.85 8.569l3.434-4.297a.389.389 0 0 0-.029-.518z" />
                                    <path fill-rule="evenodd"
                                        d="M6.664 15.889A8 8 0 1 1 9.336.11a8 8 0 0 1-2.672 15.78zm-4.665-4.283A11.945 11.945 0 0 1 8 10c2.186 0 4.236.585 6.001 1.606a7 7 0 1 0-12.002 0z" />
                                </svg>
                                <div id="client" style="font-size: 45px;padding: 10px;"></div>
                            </div>
                        </div>
                    </div>
                    <div id="add-coin" class="box-items" style="background-color: darkviolet;cursor: pointer;">
                        <div style="display: flex;align-items: center;">
                            <svg xmlns="http://www.w3.org/2000/svg" style="color: aqua;" width="45px" height="45px"
                                fill="currentColor" class="bi bi-battery-charging" viewBox="0 0 16 16">
                                <path
                                    d="M9.585 2.568a.5.5 0 0 1 .226.58L8.677 6.832h1.99a.5.5 0 0 1 .364.843l-5.334 5.667a.5.5 0 0 1-.842-.49L5.99 9.167H4a.5.5 0 0 1-.364-.843l5.333-5.667a.5.5 0 0 1 .616-.09z" />
                                <path
                                    d="M2 4h4.332l-.94 1H2a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h2.38l-.308 1H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z" />
                                <path
                                    d="M2 6h2.45L2.908 7.639A1.5 1.5 0 0 0 3.313 10H2V6zm8.595-2-.308 1H12a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H9.276l-.942 1H12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.405z" />
                                <path
                                    d="M12 10h-1.783l1.542-1.639c.097-.103.178-.218.241-.34V10zm0-3.354V6h-.646a1.5 1.5 0 0 1 .646.646zM16 8a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8z" />
                            </svg>
                            <div style="font-size: 40px;padding: 10px;">加值</div>
                        </div>
                    </div>
                </div>
                <div id="pay-page" style="display: none;">
                    <div class="box-items" onclick="Pay('1')" style="background-color: dimgrey;cursor: pointer;">
                        <div style="font-size: 24px;font-weight: 900;">加值硬幣數量</div>
                        <div style="display: flex;align-items: center;">
                            <svg xmlns="http://www.w3.org/2000/svg" style="color: darkorange;" width="45px"
                                height="45px" fill="currentColor" class="bi bi-database-fill-add" viewBox="0 0 16 16">
                                <path
                                    d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm.5-5v1h1a.5.5 0 0 1 0 1h-1v1a.5.5 0 0 1-1 0v-1h-1a.5.5 0 0 1 0-1h1v-1a.5.5 0 0 1 1 0ZM8 1c-1.573 0-3.022.289-4.096.777C2.875 2.245 2 2.993 2 4s.875 1.755 1.904 2.223C4.978 6.711 6.427 7 8 7s3.022-.289 4.096-.777C13.125 5.755 14 5.007 14 4s-.875-1.755-1.904-2.223C11.022 1.289 9.573 1 8 1Z" />
                                <path
                                    d="M2 7v-.839c.457.432 1.004.751 1.49.972C4.722 7.693 6.318 8 8 8s3.278-.307 4.51-.867c.486-.22 1.033-.54 1.49-.972V7c0 .424-.155.802-.411 1.133a4.51 4.51 0 0 0-4.815 1.843A12.31 12.31 0 0 1 8 10c-1.573 0-3.022-.289-4.096-.777C2.875 8.755 2 8.007 2 7Zm6.257 3.998L8 11c-1.682 0-3.278-.307-4.51-.867-.486-.22-1.033-.54-1.49-.972V10c0 1.007.875 1.755 1.904 2.223C4.978 12.711 6.427 13 8 13h.027a4.552 4.552 0 0 1 .23-2.002Zm-.002 3L8 14c-1.682 0-3.278-.307-4.51-.867-.486-.22-1.033-.54-1.49-.972V13c0 1.007.875 1.755 1.904 2.223C4.978 15.711 6.427 16 8 16c.536 0 1.058-.034 1.555-.097a4.507 4.507 0 0 1-1.3-1.905Z" />
                            </svg>
                            <div style="font-size: 45px;padding: 10px;text-align: end;">
                                <div style="font-size: 45px;">+100 硬幣</div>
                                <div style="font-size: 22px;padding-right: 8px;">NTD 100</div>
                            </div>
                        </div>
                    </div>
                    <div class="box-items" onclick="Pay('2')" style="background-color: darkslategrey;cursor: pointer;">
                        <div style="font-size: 24px;font-weight: 900;">加值硬幣數量</div>
                        <div style="display: flex;align-items: center;">
                            <svg xmlns="http://www.w3.org/2000/svg" style="color: darkorange;" width="45px"
                                height="45px" fill="currentColor" class="bi bi-database-fill-add" viewBox="0 0 16 16">
                                <path
                                    d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm.5-5v1h1a.5.5 0 0 1 0 1h-1v1a.5.5 0 0 1-1 0v-1h-1a.5.5 0 0 1 0-1h1v-1a.5.5 0 0 1 1 0ZM8 1c-1.573 0-3.022.289-4.096.777C2.875 2.245 2 2.993 2 4s.875 1.755 1.904 2.223C4.978 6.711 6.427 7 8 7s3.022-.289 4.096-.777C13.125 5.755 14 5.007 14 4s-.875-1.755-1.904-2.223C11.022 1.289 9.573 1 8 1Z" />
                                <path
                                    d="M2 7v-.839c.457.432 1.004.751 1.49.972C4.722 7.693 6.318 8 8 8s3.278-.307 4.51-.867c.486-.22 1.033-.54 1.49-.972V7c0 .424-.155.802-.411 1.133a4.51 4.51 0 0 0-4.815 1.843A12.31 12.31 0 0 1 8 10c-1.573 0-3.022-.289-4.096-.777C2.875 8.755 2 8.007 2 7Zm6.257 3.998L8 11c-1.682 0-3.278-.307-4.51-.867-.486-.22-1.033-.54-1.49-.972V10c0 1.007.875 1.755 1.904 2.223C4.978 12.711 6.427 13 8 13h.027a4.552 4.552 0 0 1 .23-2.002Zm-.002 3L8 14c-1.682 0-3.278-.307-4.51-.867-.486-.22-1.033-.54-1.49-.972V13c0 1.007.875 1.755 1.904 2.223C4.978 15.711 6.427 16 8 16c.536 0 1.058-.034 1.555-.097a4.507 4.507 0 0 1-1.3-1.905Z" />
                            </svg>
                            <div style="font-size: 45px;padding: 10px;text-align: end;">
                                <div style="font-size: 45px;">+500 硬幣</div>
                                <div style="font-size: 22px;padding-right: 8px;">NTD 500</div>
                            </div>
                        </div>
                    </div>
                    <div class="box-items" onclick="Pay('3')" style="background-color: darkslateblue;cursor: pointer;">
                        <div style="font-size: 24px;font-weight: 900;">加值硬幣數量</div>
                        <div style="display: flex;align-items: center;">
                            <svg xmlns="http://www.w3.org/2000/svg" style="color: darkorange;" width="45px"
                                height="45px" fill="currentColor" class="bi bi-database-fill-add" viewBox="0 0 16 16">
                                <path
                                    d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm.5-5v1h1a.5.5 0 0 1 0 1h-1v1a.5.5 0 0 1-1 0v-1h-1a.5.5 0 0 1 0-1h1v-1a.5.5 0 0 1 1 0ZM8 1c-1.573 0-3.022.289-4.096.777C2.875 2.245 2 2.993 2 4s.875 1.755 1.904 2.223C4.978 6.711 6.427 7 8 7s3.022-.289 4.096-.777C13.125 5.755 14 5.007 14 4s-.875-1.755-1.904-2.223C11.022 1.289 9.573 1 8 1Z" />
                                <path
                                    d="M2 7v-.839c.457.432 1.004.751 1.49.972C4.722 7.693 6.318 8 8 8s3.278-.307 4.51-.867c.486-.22 1.033-.54 1.49-.972V7c0 .424-.155.802-.411 1.133a4.51 4.51 0 0 0-4.815 1.843A12.31 12.31 0 0 1 8 10c-1.573 0-3.022-.289-4.096-.777C2.875 8.755 2 8.007 2 7Zm6.257 3.998L8 11c-1.682 0-3.278-.307-4.51-.867-.486-.22-1.033-.54-1.49-.972V10c0 1.007.875 1.755 1.904 2.223C4.978 12.711 6.427 13 8 13h.027a4.552 4.552 0 0 1 .23-2.002Zm-.002 3L8 14c-1.682 0-3.278-.307-4.51-.867-.486-.22-1.033-.54-1.49-.972V13c0 1.007.875 1.755 1.904 2.223C4.978 15.711 6.427 16 8 16c.536 0 1.058-.034 1.555-.097a4.507 4.507 0 0 1-1.3-1.905Z" />
                            </svg>
                            <div style="font-size: 45px;padding: 10px;text-align: end;">
                                <div style="font-size: 45px;">+1000 硬幣</div>
                                <div style="font-size: 22px;padding-right: 8px;">NTD 1000</div>
                            </div>
                        </div>
                    </div>
                </div>
                <form id="Pay" style="display: none;" action="https://ccore.newebpay.com/MPG/mpg_gateway" method="POST">
                    <input type="text" name="MerchantID" value="MS149651414" hidden />
                    <input type="text" id="TradeInfo" name="TradeInfo" hidden />
                    <input type="text" id="TradeSha" name="TradeSha" hidden />
                    <input type="text" name="Version" value="2.0" hidden />
                    <button class="Pay" type="submit">前往付款</button>
                </form>
                <div style="padding: 15px;">
                    <div style="display: flex;align-items: center;">
                        <svg xmlns="http://www.w3.org/2000/svg" style="color: red;" width="45px" height="45px"
                            fill="currentColor" class="bi bi-envelope" viewBox="0 0 16 16">
                            <path
                                d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4Zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2Zm13 2.383-4.708 2.825L15 11.105V5.383Zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741ZM1 11.105l4.708-2.897L1 5.383v5.722Z" />
                        </svg>
                        <div style="font-size: 38px;font-weight: 900;padding: 5px;">公告</div>
                    </div>
                    <div id="announcement" style="font-size: 45px;padding: 10px;">無</div>
                </div>
            </div>
            <div id="box-service" class="box-item">
                <div style="display: flex;align-items: center;">
                    <div style="font-size: 30px;font-weight: 900;padding: 10px;">可用服務列表</div>
                    <div class="load" onclick="load()">刷新</div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>說明</th>
                            <th>API</th>
                            <th>費用</th>
                            <th>服務</th>
                            <th>狀態</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="table-service"></tbody>
                </table>
                <div class="warn">⚠️<b>注意</b><br>WebSocket 模式下可以收到「較穩定快速的地震預警」</div>
            </div>
            <div id="box-key" class="box-item">
                <div>
                    <input class="note" id="note" type="text" placeholder="備註(可不填)">
                    <button id="create">創建金鑰</button>
                </div>
                <div style="display: flex;align-items: center;">
                    <div style="font-size: 30px;font-weight: 900;padding: 10px;">金鑰列表</div>
                    <div class="load" onclick="load()">刷新</div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Key(前10位)</th>
                            <th>創建時間</th>
                            <th>備註</th>
                            <th>操作</th>
                            <th>其他</th>
                        </tr>
                    </thead>
                    <tbody id="table-key"></tbody>
                </table>
            </div>
            <div id="box-status" class="box-item">
                <div style="display: flex;align-items: center;">
                    <div style="font-size: 30px;font-weight: 900;padding: 10px;">金鑰狀態列表</div>
                    <div class="load" onclick="load()">刷新</div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Key(前10位)</th>
                            <th>IP</th>
                            <th>初次連線時間</th>
                            <th>最後連線時間</th>
                        </tr>
                    </thead>
                    <tbody id="table-status"></tbody>
                </table>
            </div>
            <div id="box-device" class="box-item">
                <div style="display: flex;align-items: center;">
                    <div style="font-size: 30px;font-weight: 900;padding: 10px;">在線設備列表</div>
                    <div class="load" onclick="load()">刷新</div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>UUID(前10位)</th>
                            <th>IP</th>
                            <th>連線時間</th>
                        </tr>
                    </thead>
                    <tbody id="table-device"></tbody>
                </table>
            </div>
            <div id="box-info" class="box-item">
                <div>ExpTech Studio</div>
            </div>
        </div>
    </div>

    <style>
        @import url(https://fonts.googleapis.com/earlyaccess/cwtexyen.css);

        html,
        body {
            font-family: "cwTeXYen", sans-serif;
            user-select: none;
            background-color: #333439;
            color: white;
        }

        table {
            border-collapse: collapse;
            font-size: 0.9em;
            font-family: sans-serif;
            min-width: 400px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
            border-radius: 4px;
            overflow: hidden;
        }

        table>thead>tr {
            background-color: hsl(300deg 100% 30%);
            text-align: left;
        }

        table th,
        table td {
            color: #fff;
            padding: 8px 10px;
            text-align: center;
            border: 0.2px solid darkgray;
        }

        table>tbody>tr>td::after {
            display: block;
            content: attr(data-text);
            font-weight: bold;
            height: 0;
            overflow: hidden;
            visibility: hidden;
            pointer-events: none;
        }

        table>tbody>tr {
            background-color: hsl(300deg 100% 30% / 12%);
        }

        table>tbody>tr:nth-of-type(even) {
            background-color: hsl(300deg 100% 60% / 12%);
        }

        table>tbody>tr:last-of-type {
            border-bottom: 2px solid hsl(300deg 100% 30%);
        }

        table>tbody>tr:hover {
            font-weight: bold;
            color: hsl(300deg 100% 30%);
        }

        .title {
            font-size: 24px;
            font-weight: 900;
            padding-left: 10px;
        }

        .subtitle {
            font-size: 16px;
            font-weight: 300;
            padding-left: 10px;
        }

        .note {
            border-radius: 5px;
            text-align: center;
            color: white;
            background-color: #333439;
            border: 2px solid white;
            outline: none;
            font-size: 20px;
        }

        .main {
            font-size: 30px;
            display: flex;
            height: 100%;
        }

        .load {
            font-size: 20px;
            padding: 5px;
            margin: 3px;
            border: 2px solid white;
            border-radius: 5px;
            background-color: dodgerblue;
            cursor: pointer;
        }

        .menu {
            width: 10%;
            text-align: center;
        }

        .box {
            width: 90%;
        }

        .menu-item {
            color: darkgrey;
            font-size: 40px;
            padding: 20px;
            margin: 10px;
            border: 2px solid white;
            border-radius: 5px;
            cursor: pointer;
        }

        .box-item {
            display: none;
            padding: 5px;
            margin: 10px;
        }

        .box-items {
            padding: 10px;
            margin: 5px;
            border-radius: 10px;
            border: 2px solid white;
            width: fit-content;
        }

        .Pay {
            font-size: 40px;
            font-weight: 900;
            border-radius: 5px;
            color: gold;
            background-color: #333439;
            border-color: gold;
            cursor: pointer;
            padding: 10px;
            margin: 5px;
        }

        .warn {
            color: gold;
            font-size: 24px;
            padding: 5px;
        }
    </style>

    <script>
        const menu_index = document.getElementById("menu-index");
        const menu_service = document.getElementById("menu-service");
        const menu_key = document.getElementById("menu-key");
        const menu_status = document.getElementById("menu-status");
        const menu_device = document.getElementById("menu-device");
        const menu_info = document.getElementById("menu-info");
        const box_index = document.getElementById("box-index");
        const box_service = document.getElementById("box-service");
        const box_key = document.getElementById("box-key");
        const box_status = document.getElementById("box-status");
        const box_device = document.getElementById("box-device");
        const box_info = document.getElementById("box-info");

        const table_service = document.getElementById("table-service");
        const table_device = document.getElementById("table-device");
        const table_status = document.getElementById("table-status");
        const table_key = document.getElementById("table-key");

        const create = document.getElementById("create");
        const note = document.getElementById("note");

        const urlSearchParams = new URLSearchParams(window.location.search);
        const params = Object.fromEntries(urlSearchParams.entries());

        let service_list = []
        let user_info = {}

        if (!params.token) window.location.href = './login.html';

        document.getElementById("add-coin").onclick = () => {
            document.getElementById("info-page").style.display = "none";
            document.getElementById("pay-page").style.display = "";
        }

        function Pay(type) {
            document.getElementById("pay-page").style.display = "none";
            fetch(`https://exptech.com.tw/api/v1/et/pay?type=${type}&token=${params.token}`)
                .then(async res => {
                    const data = await res.json();
                    document.getElementById("TradeInfo").value = data.TradeInfo;
                    document.getElementById("TradeSha").value = data.TradeSha;
                    document.getElementById("Pay").style.display = "";
                })
                .catch(err => {
                    console.error(err);
                    const res = err.request.response;
                    alert(res);
                });
        }

        const time_string = (time) => {
            const now = new Date(time);
            let Now = now.getFullYear().toString();
            Now += "/";
            if ((now.getMonth() + 1) < 10) Now += "0" + (now.getMonth() + 1).toString();
            else Now += (now.getMonth() + 1).toString();
            Now += "/";
            if (now.getDate() < 10) Now += "0" + now.getDate().toString();
            else Now += now.getDate().toString();
            Now += " ";
            if (now.getHours() < 10) Now += "0" + now.getHours().toString();
            else Now += now.getHours().toString();
            Now += ":";
            if (now.getMinutes() < 10) Now += "0" + now.getMinutes().toString();
            else Now += now.getMinutes().toString();
            Now += ":";
            if (now.getSeconds() < 10) Now += "0" + now.getSeconds().toString();
            else Now += now.getSeconds().toString();
            return Now;
        }

        fetch(`https://exptech.com.tw/api/v1/et/service-list`)
            .then(async res => {
                service_list = await res.json();
                load();
            })
            .catch(err => {
                console.error(err);
                const res = err.request.response;
                alert(res);
            });

        function load() {
            for (const item of document.getElementsByClassName("load"))
                item.style.display = "none";
            fetch(`https://exptech.com.tw/api/v1/et/info?token=${params.token}`)
                .then(async res => {
                    user_info = await res.json();
                    document.getElementById("client").textContent = `${Object.keys(user_info.client_list).length}/${user_info.client}`;
                    document.getElementById("coin").textContent = user_info.coin;
                    document.getElementById("use").textContent = user_info.use;
                    document.getElementById("day").textContent = (!user_info.coin) ? "已用完" : (!user_info.use) ? "未使用" : `${Math.floor(user_info.coin / user_info.use)} 天`;
                    reload_service();
                    reload_device();
                    reload_status();
                    reload_key();
                    setTimeout(() => {
                        for (const item of document.getElementsByClassName("load"))
                            item.style.display = "";
                    }, 3000)
                })
                .catch(err => {
                    console.error(err);
                    const res = err.request.response;
                    alert(res);
                });
        }

        function switch_service(type, status) {
            fetch(`https://exptech.com.tw/api/v1/et/${(!status) ? "subscribe" : "unsubscribe"}?token=${params.token}&type=${type}`)
                .then(res => load())
                .catch(err => {
                    console.error(err);
                    const res = err.request.response;
                    alert(res);
                });
        }

        function copy(key) {
            navigator.clipboard.writeText(key)
                .then(() => alert("金鑰已複製到剪貼板"))
                .catch(err => console.error(err));
        }

        function del(key) {
            fetch(`https://exptech.com.tw/api/v1/et/key-remove?token=${params.token}&key=${key}`)
                .then(res => load())
                .catch(err => {
                    console.error(err);
                    const res = err.request.response;
                    alert(res);
                });
        }

        function reload_key() {
            const frag = new DocumentFragment();
            for (let i = 0; i < Object.keys(user_info.key).length; i++) {
                const k = Object.keys(user_info.key)[i];
                const box = document.createElement("tr");

                const key = document.createElement("td");
                key.textContent = k.substring(0, 10);
                key.setAttribute("data-text", key.textContent);

                const time = document.createElement("td");
                time.textContent = time_string(user_info.key[k].time);
                time.setAttribute("data-text", time.textContent);

                const note = document.createElement("td");
                note.textContent = user_info.key[k].note;
                note.setAttribute("data-text", note.textContent);

                const action = document.createElement("td");
                action.innerHTML = `<a style="color: lightskyblue;text-decoration:underline;cursor: pointer;" onclick="copy('${k}')">複製金鑰</a>`;
                action.setAttribute("data-text", action.textContent);

                const del = document.createElement("td");
                del.innerHTML = `<a style="color: red;text-decoration:underline;cursor: pointer;" onclick="del('${k}')">刪除金鑰</a>`;
                del.setAttribute("data-text", del.textContent);

                box.appendChild(key);
                box.appendChild(time);
                box.appendChild(note);
                box.appendChild(action);
                box.appendChild(del);
                frag.appendChild(box);
            }

            table_key.replaceChildren(frag);
        }

        function reload_status() {
            const frag = new DocumentFragment();
            for (let i = 0; i < Object.keys(user_info.key_list).length; i++) {
                const k = Object.keys(user_info.key_list)[i];
                const box = document.createElement("tr");

                const key = document.createElement("td");
                key.textContent = k.substring(0, 10);
                key.setAttribute("data-text", key.textContent);

                const ip = document.createElement("td");
                ip.textContent = user_info.key_list[k].ip;
                ip.setAttribute("data-text", ip.textContent);

                const first = document.createElement("td");
                first.textContent = time_string(user_info.key_list[k].start);
                first.setAttribute("data-text", first.textContent);

                const last = document.createElement("td");
                last.textContent = time_string(user_info.key_list[k].time);
                last.setAttribute("data-text", last.textContent);

                box.appendChild(key);
                box.appendChild(ip);
                box.appendChild(first);
                box.appendChild(last);
                frag.appendChild(box);
            }

            table_status.replaceChildren(frag);
        }

        function reload_device() {
            const frag = new DocumentFragment();
            for (let i = 0; i < Object.keys(user_info.client_list).length; i++) {
                const id = Object.keys(user_info.client_list)[i];
                const box = document.createElement("tr");

                const uuid = document.createElement("td");
                uuid.textContent = id.substring(0, 10);
                uuid.setAttribute("data-text", uuid.textContent);

                const ip = document.createElement("td");
                ip.textContent = user_info.client_list[id].ip;
                ip.setAttribute("data-text", ip.textContent);

                const first = document.createElement("td");
                first.textContent = time_string(user_info.client_list[id].time);
                first.setAttribute("data-text", first.textContent);

                box.appendChild(uuid);
                box.appendChild(ip);
                box.appendChild(first);
                frag.appendChild(box);
            }

            table_device.replaceChildren(frag);
        }

        function reload_service() {
            const frag = new DocumentFragment();
            for (let i = 0; i < service_list.length; i++) {
                const item = service_list[i];
                const box = document.createElement("tr");

                const name = document.createElement("td");
                name.textContent = item.name;
                name.setAttribute("data-text", name.textContent);

                const api = document.createElement("td");
                api.textContent = item.api;
                api.setAttribute("data-text", api.textContent);

                const coin = document.createElement("td");
                coin.textContent = `${item.coin} 硬幣/天`;
                coin.setAttribute("data-text", coin.textContent);

                const service = document.createElement("td");
                const ser = user_info.service?.includes(item.api);
                service.textContent = (ser || typeof item.type == "boolean") ? "服務中" : "未提供";
                service.style.backgroundColor = (ser || typeof item.type == "boolean") ? "green" : "red";
                service.setAttribute("data-text", service.textContent);

                const status = document.createElement("td");
                let sub = user_info.subscribe?.includes(item.api);
                if (!sub) user_info.service?.includes(item.api)
                if (item.type && typeof item.type == "string") status.textContent = (sub) ? "已訂閱" : "未訂閱";
                if (item.type && typeof item.type == "string") status.style.backgroundColor = (sub) ? "green" : "red";
                status.setAttribute("data-text", status.textContent);

                const type = document.createElement("td");
                if (item.type && typeof item.type == "string") type.innerHTML = `<a style="color: ${(sub) ? "white" : "lightskyblue"};text-decoration:underline;cursor: pointer;" onclick="switch_service('${item.type}',${sub})">${(sub) ? "取消" : "訂閱"}</a>`;
                type.setAttribute("data-text", type.textContent);

                box.appendChild(name);
                box.appendChild(api);
                box.appendChild(coin);
                box.appendChild(service);
                box.appendChild(status);
                box.appendChild(type);
                frag.appendChild(box);
            }

            table_service.replaceChildren(frag);
        }

        create.onclick = () => {
            fetch("https://exptech.com.tw/api/v1/et/key-add", {
                method: "POST",
                headers: { "Content-Type": "application/json", },
                body: JSON.stringify({
                    token: params.token,
                    note: note.value,
                })
            })
                .then(async res => {
                    load();
                    note.value = "";
                })
                .catch(err => {
                    console.error(err);
                    const res = err.request.response;
                    alert(res);
                });
        }

        menu_index.onclick = () => {
            for (const item of document.getElementsByClassName("menu-item"))
                item.style.color = "darkgrey";
            menu_index.style.color = "white";
            for (const item of document.getElementsByClassName("box-item"))
                item.style.display = "none";
            box_index.style.display = "block";
            document.getElementById("info-page").style.display = "";
            document.getElementById("pay-page").style.display = "none";
            document.getElementById("Pay").style.display = "none";
        }
        menu_service.onclick = () => {
            for (const item of document.getElementsByClassName("menu-item"))
                item.style.color = "darkgrey";
            menu_service.style.color = "white";
            for (const item of document.getElementsByClassName("box-item"))
                item.style.display = "none";
            box_service.style.display = "block";
        }
        menu_key.onclick = () => {
            for (const item of document.getElementsByClassName("menu-item"))
                item.style.color = "darkgrey";
            menu_key.style.color = "white";
            for (const item of document.getElementsByClassName("box-item"))
                item.style.display = "none";
            box_key.style.display = "block";
        }
        menu_status.onclick = () => {
            for (const item of document.getElementsByClassName("menu-item"))
                item.style.color = "darkgrey";
            menu_status.style.color = "white";
            for (const item of document.getElementsByClassName("box-item"))
                item.style.display = "none";
            box_status.style.display = "block";
        }
        menu_device.onclick = () => {
            for (const item of document.getElementsByClassName("menu-item"))
                item.style.color = "darkgrey";
            menu_device.style.color = "white";
            for (const item of document.getElementsByClassName("box-item"))
                item.style.display = "none";
            box_device.style.display = "block";
        }
        menu_info.onclick = () => {
            for (const item of document.getElementsByClassName("menu-item"))
                item.style.color = "darkgrey";
            menu_info.style.color = "white";
            for (const item of document.getElementsByClassName("box-item"))
                item.style.display = "none";
            box_info.style.display = "block";
        }

        setInterval(() => load(), 60_000);
    </script>
</body>

</html>